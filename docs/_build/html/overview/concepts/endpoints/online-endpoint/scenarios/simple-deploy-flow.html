<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="../../../../../genindex.html" /><link rel="search" title="Search" href="../../../../../search.html" /><link rel="next" title="Declarative Canary Flow (aka Gitops flow)" href="declarative-flow.html" /><link rel="prev" title="Deployment Scenarios" href="../scenarios.html" />

    <meta name="generator" content="sphinx-3.5.2, furo 2021.02.28.beta28"/>
        <title>Simple deploy flow - azure.ml 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/styles/furo.css?digest=be5985a4059b5c2cd56ed0804790452beca62674">
    <link rel="stylesheet" href="../../../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" href="../../../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../../index.html"><div class="brand">azure.ml 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../../index.html">
  
  
  <span class="sidebar-brand-text">azure.ml 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../setup.html">Cloud Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/jobs.html">Train Models (Create Jobs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/distributed-training.html">Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quickstart/endpoints.html">Deploy Models (WIP)</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../../concepts.html">Concepts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../data.html">Manage Data Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data.html#manage-datastore-connections">Manage Datastore Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../quickstart/jobs.html">Train Models (Create Jobs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../model.html">Manage Models</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../../../endpoint.html">Manage Endpoints (WIP)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current has-children"><a class="reference internal" href="../online-endpoint.html">Online Endpoints (WIP)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4 current has-children"><a class="reference internal" href="../scenarios.html">Deployment Scenarios</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l5 current current-page"><a class="current reference internal" href="#">Simple deploy flow</a></li>
<li class="toctree-l5"><a class="reference internal" href="declarative-flow.html">Declarative Canary Flow (aka Gitops flow)</a></li>
<li class="toctree-l5"><a class="reference internal" href="imperative-flow.html">Imperative Canary Flow</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../managed-online-endpoints.html">Managed online endpoints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../batch-endpoint/batch-endpoint.html">Batch Endpoint (WIP)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../environment.html">Manage Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../compute.html">Compute Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workspace.html">Manage Workspaces</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/templates.html">ARM Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/feedback.html">Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/qna.html">Q&amp;A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference/azure-ml.html">Azure-ML Reference</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="simple-deploy-flow">
<span id="id1"></span><h1>Simple deploy flow<a class="headerlink" href="#simple-deploy-flow" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>Clone or fork this <a class="reference external" href="https://github.com/Azure/azureml-v2-preview">repo</a> to try the below scenarios from your CLI.</p></li>
<li><p>Private preview for this functionality is invite only at this point (your subscription needs to be onboarded).</p></li>
</ol>
</div>
<div class="section" id="step-1-deploy-simple-endpoint">
<h2>Step 1: Deploy simple endpoint<a class="headerlink" href="#step-1-deploy-simple-endpoint" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint create --name my-endpoint -f examples/endpoints/online/managed/simple-flow/1-create-endpoint-with-blue.yaml
</pre></div>
</div>
<p><strong>Note</strong>: Replace the above endpoint name with a unique name (it should be unique at region level). Use the same name in all of the below commands.</p>
<p>This is the yaml file</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># yaml-language-server: $schema=https://azuremlsdk2.blob.core.windows.net/latest/onlineEndpoint.schema.json</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-endpoint</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">online</span>
<span class="nt">infrastructure</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">managed</span>
<span class="nt">auth_mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aml_token</span>
<span class="nt">traffic</span><span class="p">:</span>
  <span class="nt">blue</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="nt">deployments</span><span class="p">:</span>
  <span class="c1">#blue deployment</span>
  <span class="nt">blue</span><span class="p">:</span>    
    <span class="nt">model</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">model-1</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">local_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">../../model-1/model/sklearn_regression_model.pkl</span>
    <span class="nt">code_configuration</span><span class="p">:</span>
      <span class="nt">code</span><span class="p">:</span> 
        <span class="nt">local_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">../../model-1/onlinescoring/</span>
      <span class="nt">scoring_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">score.py</span>
    <span class="nt">environment</span><span class="p">:</span> 
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">env-model1</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
      <span class="nt">conda_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file:../../model-1/environment/conda.yml</span>
      <span class="nt">docker</span><span class="p">:</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mcr.microsoft.com/azureml/intelmpi2018.3-ubuntu16.04:20210301.v1</span>
    <span class="nt">sku</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Standard_F2s_v2</span>
    <span class="nt">scale_settings</span><span class="p">:</span>
      <span class="nt">scale_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">manual</span>
      <span class="nt">instance_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">min_instances</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">max_instances</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<div class="section" id="get-the-state-of-endpoint-deployment-along-with-the-status">
<h3>Get the state of endpoint/deployment along with the status<a class="headerlink" href="#get-the-state-of-endpoint-deployment-along-with-the-status" title="Permalink to this headline">Â¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint show -n my-endpoint
</pre></div>
</div>
<p>you can use the <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/query-azure-cli">âquery parameter</a> to get only specific attributes from the returned data</p>
</div>
</div>
<div class="section" id="step-2-now-test-the-endpoint">
<h2>Step 2: Now test the endpoint<a class="headerlink" href="#step-2-now-test-the-endpoint" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint invoke -n my-endpoint --request-file examples/endpoints/online/model-1/sample-request.json
</pre></div>
</div>
<p>For instructions on using your own client (like postman) see the Appendix below</p>
</div>
<div class="section" id="step-3-check-the-container-logs">
<h2>Step 3: Check the container logs<a class="headerlink" href="#step-3-check-the-container-logs" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint log -n my-endpoint --deployment blue --tail <span class="m">100</span>
</pre></div>
</div>
<p>by default the logs are pulled from the <cite>inference-server</cite>. However you can pull it from <cite>storage-initializer</cite> container by passing âcontainer <cite>storage-initializer</cite></p>
</div>
<div class="section" id="step-4-check-out-metrics-from-azure-poral">
<h2>Step 4: Check out metrics from Azure Poral<a class="headerlink" href="#step-4-check-out-metrics-from-azure-poral" title="Permalink to this headline">Â¶</a></h2>
<p>Open the resource group from azure portal -&gt; open the endpoint and deployment ARM resources
-&gt; you can see summary view in the overview page and details in the metrics tab</p>
</div>
<div class="section" id="step-5-check-out-log-analytics">
<h2>Step 5: Check out log analytics<a class="headerlink" href="#step-5-check-out-log-analytics" title="Permalink to this headline">Â¶</a></h2>
<p>1. Create a log analytics workspace. Note: During preview period, both loganalytics workspace and azure ml workspace has to be in either westeurope or westus2.
1. Open the ARM resource page from endpoint -&gt; select <cite>Diagnostic settings</cite> -&gt; Add settings (add a log analytics workspace - create one if needed)
2. Make some scoring requests for logs to flow to Log Analytics
3. Open the log analytics workspace -&gt; Click on <cite>Logs</cite> on left nav -&gt; Close the <cite>Queries</cite> popup opend by default -&gt; double click on <cite>AmlOnlineEndpointConsoleLog</cite> -&gt; click <cite>Run</cite></p>
</div>
<div class="section" id="step-6-optionally-delete-the-endpoint-along-with-the-deployment">
<h2>Step 6: [Optionally] Delete the endpoint along with the deployment<a class="headerlink" href="#step-6-optionally-delete-the-endpoint-along-with-the-deployment" title="Permalink to this headline">Â¶</a></h2>
<p>Do <strong>not</strong> run this step if you plan to run the <a class="reference internal" href="declarative-flow.html#declarative-flow"><span class="std std-ref">Declarative Canary Flow (aka Gitops flow)</span></a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint delete -n my-endpoint
</pre></div>
</div>
</div>
<div class="section" id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="invoking-the-scoring-endpoint-using-rest-clients">
<h3>Invoking the scoring endpoint using REST clients<a class="headerlink" href="#invoking-the-scoring-endpoint-using-rest-clients" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Step 1: Get the scoring URI</strong></p>
<p>replace âmy-endpointsâ with name of your endpoint in the below command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint show -n my-endpoint --query <span class="s2">"scoring_uri"</span>
</pre></div>
</div>
<p><strong>Step 2: Get the azure ml auth token</strong></p>
<p>Copy the value of the accessToken from this</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>az ml endpoint list-keys -n my-endpoint
</pre></div>
</div>
<p><strong>Step 3: Use the URI and the token in your REST client</strong></p>
<p>If you use postman, then go to the Authorization tab in the request and paste the value of the token. Use the scoring uri form above as the URI for the POST request.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="declarative-flow.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Declarative Canary Flow (aka Gitops flow)</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../scenarios.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Deployment Scenarios</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020, Microsoft
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../../../_sources/overview/concepts/endpoints/online-endpoint/scenarios/simple-deploy-flow.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simple deploy flow</a><ul>
<li><a class="reference internal" href="#step-1-deploy-simple-endpoint">Step 1: Deploy simple endpoint</a><ul>
<li><a class="reference internal" href="#get-the-state-of-endpoint-deployment-along-with-the-status">Get the state of endpoint/deployment along with the status</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-now-test-the-endpoint">Step 2: Now test the endpoint</a></li>
<li><a class="reference internal" href="#step-3-check-the-container-logs">Step 3: Check the container logs</a></li>
<li><a class="reference internal" href="#step-4-check-out-metrics-from-azure-poral">Step 4: Check out metrics from Azure Poral</a></li>
<li><a class="reference internal" href="#step-5-check-out-log-analytics">Step 5: Check out log analytics</a></li>
<li><a class="reference internal" href="#step-6-optionally-delete-the-endpoint-along-with-the-deployment">Step 6: [Optionally] Delete the endpoint along with the deployment</a></li>
<li><a class="reference internal" href="#appendix">Appendix</a><ul>
<li><a class="reference internal" href="#invoking-the-scoring-endpoint-using-rest-clients">Invoking the scoring endpoint using REST clients</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>